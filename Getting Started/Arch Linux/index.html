

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Arch Linux &mdash; OpenZFS  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/mandoc.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Arch Linux Root on ZFS" href="Arch Linux Root on ZFS.html" />
    <link rel="prev" title="Getting Started" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #29667e" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo_main.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Getting Started</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Arch Linux</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#add-archzfs-repo">Add archzfs repo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prebuilt-zfs-package">Prebuilt zfs package</a></li>
<li class="toctree-l4"><a class="reference internal" href="#archzfs-dkms-package">archzfs-dkms package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#check-live-image-compatibility">Check Live Image Compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="#root-on-zfs">Root on ZFS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Arch Linux Root on ZFS.html">Arch Linux Root on ZFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="Artix Linux Root on ZFS.html">Artix Linux Root on ZFS</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Debian/index.html">Debian</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Fedora.html">Fedora</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FreeBSD.html">FreeBSD</a></li>
<li class="toctree-l2"><a class="reference external" href="https://wiki.gentoo.org/wiki/ZFS">Gentoo</a></li>
<li class="toctree-l2"><a class="reference external" href="https://nixos.wiki/wiki/NixOS_on_ZFS">NixOS</a></li>
<li class="toctree-l2"><a class="reference external" href="https://software.opensuse.org/package/zfs">openSUSE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../RHEL and CentOS.html">RHEL and CentOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Ubuntu/index.html">Ubuntu</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Project and Community/index.html">Project and Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Developer Resources/index.html">Developer Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Performance and Tuning/index.html">Performance and Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Basic Concepts/index.html">Basic Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../man/index.html">Man Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../msg/index.html">ZFS Messages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../License.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OpenZFS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Getting Started</a> &raquo;</li>
        
      <li>Arch Linux</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/openzfs/openzfs-docs/blob/master/docs/Getting Started/Arch Linux/index.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="arch-linux">
<h1>Arch Linux<a class="headerlink" href="#arch-linux" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#installation" id="id1">Installation</a></p>
<ul>
<li><p><a class="reference internal" href="#add-archzfs-repo" id="id2">Add archzfs repo</a></p></li>
<li><p><a class="reference internal" href="#prebuilt-zfs-package" id="id3">Prebuilt zfs package</a></p>
<ul>
<li><p><a class="reference internal" href="#downgrade-to-compatible-kernel" id="id4">Downgrade to compatible kernel</a></p></li>
<li><p><a class="reference internal" href="#ignore-kernel-update-when-dependency-fails" id="id5">Ignore kernel update when dependency fails</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#archzfs-dkms-package" id="id6">archzfs-dkms package</a></p>
<ul>
<li><p><a class="reference internal" href="#check-openzfs-compatibility" id="id7">Check OpenZFS compatibility</a></p></li>
<li><p><a class="reference internal" href="#normal-installation" id="id8">Normal installation</a></p></li>
<li><p><a class="reference internal" href="#install-alternative-kernel" id="id9">Install alternative kernel</a></p></li>
<li><p><a class="reference internal" href="#kernel-update" id="id10">Kernel update</a></p></li>
<li><p><a class="reference internal" href="#glibc-version-mismatch" id="id11">glibc version mismatch</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#check-live-image-compatibility" id="id12">Check Live Image Compatibility</a></p></li>
<li><p><a class="reference internal" href="#root-on-zfs" id="id13">Root on ZFS</a></p></li>
</ul>
</div>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id1">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>If you want to use ZFS as your root filesystem, see the <a class="reference internal" href="#root-on-zfs">Root on ZFS</a>
links below instead.</p>
<div class="section" id="add-archzfs-repo">
<h3><a class="toc-backref" href="#id2">Add archzfs repo</a><a class="headerlink" href="#add-archzfs-repo" title="Permalink to this headline">¶</a></h3>
<p>ZFS packages are provided by the third-party
<a class="reference external" href="https://github.com/archzfs/archzfs">archzfs repository</a>.
You can use it as follows.</p>
<p>Import archzfs GPG key:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl -O https://archzfs.com/archzfs.gpg
pacman-key -a archzfs.gpg
pacman-key --lsign-key DDF7DB817396A49B2A2723F7403BD972F75D9D76
</pre></div>
</div>
<p>Add the archzfs repository:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>tee -a /etc/pacman.conf <span class="s">&lt;&lt;- &#39;EOF&#39;</span>
<span class="s">[archzfs]</span>
<span class="s">Server = https://archzfs.com/$repo/$arch</span>
<span class="s">Server = https://mirror.sum7.eu/archlinux/archzfs/$repo/$arch</span>
<span class="s">Server = https://mirror.biocrafting.net/archlinux/archzfs/$repo/$arch</span>
<span class="s">Server = https://mirror.in.themindsmaze.com/archzfs/$repo/$arch</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p>Update pacman database:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -Sy
</pre></div>
</div>
</div>
<div class="section" id="prebuilt-zfs-package">
<h3><a class="toc-backref" href="#id3">Prebuilt zfs package</a><a class="headerlink" href="#prebuilt-zfs-package" title="Permalink to this headline">¶</a></h3>
<p>This only applies to vanilla Arch Linux kernels.
For other kernels, use <a class="reference internal" href="#archzfs-dkms-package">archzfs-dkms package</a>.
You can also switch between DKMS and prebuilt
packages with instructions on this page.</p>
<p>Check kernel variant:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">INST_LINVAR</span><span class="o">=</span><span class="k">$(</span>sed <span class="s1">&#39;s|.*linux|linux|&#39;</span> /proc/cmdline <span class="p">|</span> awk <span class="s1">&#39;{ print $1 }&#39;</span><span class="k">)</span>
</pre></div>
</div>
<p>Install compatible package:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -Sy archzfs-<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>
</pre></div>
</div>
<p>If kernel dependency failed, you can either:</p>
<ul class="simple">
<li><p>Install <a class="reference internal" href="#archzfs-dkms-package">archzfs-dkms package</a>, or</p></li>
<li><p>Downgrade kernel
to a compatible version:</p></li>
</ul>
<div class="section" id="downgrade-to-compatible-kernel">
<h4><a class="toc-backref" href="#id4">Downgrade to compatible kernel</a><a class="headerlink" href="#downgrade-to-compatible-kernel" title="Permalink to this headline">¶</a></h4>
<p>Check compatible kernel version:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">INST_LINVER</span><span class="o">=</span><span class="k">$(</span>pacman -Si zfs-<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span> <span class="se">\</span>
<span class="p">|</span> grep <span class="s1">&#39;Depends On&#39;</span> <span class="se">\</span>
<span class="p">|</span> sed <span class="s2">&quot;s|.*</span><span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span><span class="s2">=||&quot;</span> <span class="se">\</span>
<span class="p">|</span> awk <span class="s1">&#39;{ print $1 }&#39;</span><span class="k">)</span>
</pre></div>
</div>
<p>Install compatible kernel:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -U <span class="se">\</span>
https://archive.archlinux.org/packages/l/<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>-<span class="si">${</span><span class="nv">INST_LINVER</span><span class="si">}</span>-x86_64.pkg.tar.zst
</pre></div>
</div>
<p>Install archzfs:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -Sy archzfs-<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ignore-kernel-update-when-dependency-fails">
<h4><a class="toc-backref" href="#id5">Ignore kernel update when dependency fails</a><a class="headerlink" href="#ignore-kernel-update-when-dependency-fails" title="Permalink to this headline">¶</a></h4>
<p>Sometimes archzfs prebuilt package might lag behind
kernel updates:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -Syu
<span class="c1"># error: failed to prepare transaction (could not satisfy dependencies)</span>
<span class="c1"># :: installing linux-lts (5.4.93-2) breaks dependency &#39;linux-lts=5.4.92-1&#39; required by zfs-linux-lts</span>
</pre></div>
</div>
<p>Temporarily ignore kernel update to upgrade other packages:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -Syu --ignore<span class="o">=</span>linux-lts
</pre></div>
</div>
</div>
</div>
<div class="section" id="archzfs-dkms-package">
<h3><a class="toc-backref" href="#id6">archzfs-dkms package</a><a class="headerlink" href="#archzfs-dkms-package" title="Permalink to this headline">¶</a></h3>
<p>This package will dynamically build ZFS modules for
supported kernels. Both Arch Linux and derivatives
are supported.</p>
<div class="section" id="check-openzfs-compatibility">
<h4><a class="toc-backref" href="#id7">Check OpenZFS compatibility</a><a class="headerlink" href="#check-openzfs-compatibility" title="Permalink to this headline">¶</a></h4>
<p>Check kernel version:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uname -r
<span class="c1"># 5.4.92-1-lts</span>
</pre></div>
</div>
<p>Check newer archzfs-dkms package version:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">DKMS_VER</span><span class="o">=</span><span class="k">$(</span>pacman -Si zfs-dkms <span class="se">\</span>
<span class="p">|</span> grep <span class="s1">&#39;Version&#39;</span> <span class="se">\</span>
<span class="p">|</span> awk <span class="s1">&#39;{ print $3 }&#39;</span> <span class="se">\</span>
<span class="p">|</span> sed <span class="s1">&#39;s|-.*||&#39;</span><span class="k">)</span>
</pre></div>
</div>
<p>Visit OpenZFS release page</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl https://github.com/openzfs/zfs/releases/zfs-<span class="si">${</span><span class="nv">DKMS_VER</span><span class="si">}</span> <span class="se">\</span>
<span class="p">|</span> grep Linux
<span class="c1"># Linux: compatible with 3.10 - 5.10 kernels</span>
</pre></div>
</div>
<p>If it’s not supported, see <a class="reference internal" href="#install-alternative-kernel">Install alternative kernel</a>.
Otherwise, continue to next step.</p>
</div>
<div class="section" id="normal-installation">
<h4><a class="toc-backref" href="#id8">Normal installation</a><a class="headerlink" href="#normal-installation" title="Permalink to this headline">¶</a></h4>
<p>Check kernel variant:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">INST_LINVAR</span><span class="o">=</span><span class="k">$(</span>sed <span class="s1">&#39;s|.*linux|linux|&#39;</span> /proc/cmdline <span class="p">|</span> awk <span class="s1">&#39;{ print $1 }&#39;</span><span class="k">)</span>
</pre></div>
</div>
<p>Check kernel version:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">INST_LINVER</span><span class="o">=</span><span class="k">$(</span>pacman -Qi <span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span> <span class="p">|</span> grep Version <span class="p">|</span> awk <span class="s1">&#39;{ print $3 }&#39;</span><span class="k">)</span>
</pre></div>
</div>
<p>Install kernel headers:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -U https://archive.archlinux.org/packages/l/<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>-headers/<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>-headers-<span class="si">${</span><span class="nv">INST_LINVER</span><span class="si">}</span>-x86_64.pkg.tar.zst
<span class="c1"># for artix</span>
pacman -U https://archive.artixlinux.org/packages/l/<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>-headers/<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>-headers-<span class="si">${</span><span class="nv">INST_LINVER</span><span class="si">}</span>-x86_64.pkg.tar.zst
</pre></div>
</div>
<p>Install archzfs-dkms:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -Sy archzfs-dkms
</pre></div>
</div>
<p>Hold kernel package from updates:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sed -i <span class="s1">&#39;s/#.*IgnorePkg/IgnorePkg/&#39;</span> /etc/pacman.conf
sed -i <span class="s2">&quot;/^IgnorePkg/ s/</span>$<span class="s2">/ </span><span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span><span class="s2">-headers/&quot;</span> /etc/pacman.conf
</pre></div>
</div>
<p>Kernel must be manually updated, see <a class="reference internal" href="#kernel-update">Kernel update</a>.</p>
</div>
<div class="section" id="install-alternative-kernel">
<h4><a class="toc-backref" href="#id9">Install alternative kernel</a><a class="headerlink" href="#install-alternative-kernel" title="Permalink to this headline">¶</a></h4>
<p>If the kernel is not yet supported, install a supported kernel:</p>
<p>Choose kernel variant. Available variants are:</p>
<ul class="simple">
<li><p>linux</p></li>
<li><p>linux-lts</p></li>
</ul>
<p>For Artix, replace <code class="docutils literal notranslate"><span class="pre">archlinux.org</span></code> with <code class="docutils literal notranslate"><span class="pre">artixlinux.org</span></code>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">INST_LINVAR</span><span class="o">=</span>linux
</pre></div>
</div>
<p>Check build date:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">DKMS_DATE</span><span class="o">=</span><span class="k">$(</span>pacman -Syi zfs-dkms <span class="se">\</span>
<span class="p">|</span> grep <span class="s1">&#39;Build Date&#39;</span> <span class="se">\</span>
<span class="p">|</span> sed <span class="s1">&#39;s/.*: //&#39;</span> <span class="se">\</span>
<span class="p">|</span> <span class="nv">LC_ALL</span><span class="o">=</span>C xargs -i<span class="o">{}</span> date -d <span class="o">{}</span>  +%Y/%m/%d<span class="k">)</span>
</pre></div>
</div>
<p>Check kernel version:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl https://archive.archlinux.org/repos/<span class="si">${</span><span class="nv">DKMS_DATE</span><span class="si">}</span>/core/os/x86_64/ <span class="se">\</span>
<span class="p">|</span> grep <span class="se">\&quot;</span><span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>-<span class="s1">&#39;[0-9]&#39;</span> <span class="se">\</span>
<span class="p">|</span> grep -v sig
<span class="c1"># &lt;a href=&quot;linux-5.10.3.arch1-1-x86_64.pkg.tar.zst&quot;&gt;</span>
</pre></div>
</div>
<p>Set kernel version in a variable:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;a href=&quot;linux-5.10.3.arch1-1-x86_64.pkg.tar.zst&quot;&gt;</span>
<span class="nv">INST_LINVER</span><span class="o">=</span><span class="m">5</span>.10.3.arch1-1
</pre></div>
</div>
<p>Install kernel and headers:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -U <span class="se">\</span>
https://archive.archlinux.org/packages/l/<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>-<span class="si">${</span><span class="nv">INST_LINVER</span><span class="si">}</span>-x86_64.pkg.tar.zst <span class="se">\</span>
https://archive.archlinux.org/packages/l/<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>-headers/<span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span>-headers-<span class="si">${</span><span class="nv">INST_LINVER</span><span class="si">}</span>-x86_64.pkg.tar.zst
</pre></div>
</div>
<p>Install archzfs-dkms:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -Sy archzfs-dkms
</pre></div>
</div>
<p>Hold kernel package from updates:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sed -i <span class="s1">&#39;s/#IgnorePkg/IgnorePkg/&#39;</span> /etc/pacman.conf
sed -i <span class="s2">&quot;/^IgnorePkg/ s/</span>$<span class="s2">/ </span><span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">INST_LINVAR</span><span class="si">}</span><span class="s2">-headers/&quot;</span> /etc/pacman.conf
</pre></div>
</div>
<p>Kernel must be manually updated, see <a class="reference internal" href="#kernel-update">Kernel update</a>.</p>
</div>
<div class="section" id="kernel-update">
<h4><a class="toc-backref" href="#id10">Kernel update</a><a class="headerlink" href="#kernel-update" title="Permalink to this headline">¶</a></h4>
<p>This applies to archzfs-dkms package.</p>
<p>Check kernel variant:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">INST_LINVAR</span><span class="o">=</span><span class="k">$(</span>sed <span class="s1">&#39;s|.*linux|linux|&#39;</span> /proc/cmdline <span class="p">|</span> awk <span class="s1">&#39;{ print $1 }&#39;</span><span class="k">)</span>
</pre></div>
</div>
<p>Check newer kernel version:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -Syi <span class="nv">$INST_LINVAR</span> <span class="se">\</span>
<span class="p">|</span> grep <span class="s1">&#39;Version&#39;</span> <span class="se">\</span>
<span class="p">|</span> awk <span class="s1">&#39;{ print $3 }&#39;</span>
<span class="c1"># 5.10.1.1-1</span>
</pre></div>
</div>
<p>Check newer archzfs-dkms package version:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">DKMS_VER</span><span class="o">=</span><span class="k">$(</span>pacman -Si zfs-dkms <span class="se">\</span>
<span class="p">|</span> grep <span class="s1">&#39;Version&#39;</span> <span class="se">\</span>
<span class="p">|</span> awk <span class="s1">&#39;{ print $3 }&#39;</span> <span class="se">\</span>
<span class="p">|</span> sed <span class="s1">&#39;s|-.*||&#39;</span><span class="k">)</span>
</pre></div>
</div>
<p>Visit OpenZFS release page</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl https://github.com/openzfs/zfs/releases/zfs-<span class="si">${</span><span class="nv">DKMS_VER</span><span class="si">}</span> <span class="se">\</span>
<span class="p">|</span> grep Linux
<span class="c1"># Linux: compatible with 3.10 - 5.10 kernels</span>
</pre></div>
</div>
<p>If compatible, update kernel with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -S <span class="nv">$INST_LINVAR</span> <span class="nv">$INST_LINVAR</span>-headers archzfs-dkms
</pre></div>
</div>
<p>Do not update if the kernel is not compatible
with OpenZFS.</p>
</div>
<div class="section" id="glibc-version-mismatch">
<h4><a class="toc-backref" href="#id11">glibc version mismatch</a><a class="headerlink" href="#glibc-version-mismatch" title="Permalink to this headline">¶</a></h4>
<p>As of Feb 6th, 2021, latest glibc release is <code class="docutils literal notranslate"><span class="pre">2.33</span></code>.
glibc in Arch Linux repo is <code class="docutils literal notranslate"><span class="pre">2.32</span></code>.</p>
<p>When updating <code class="docutils literal notranslate"><span class="pre">linux-lts</span> <span class="pre">(5.4.94-1</span> <span class="pre">-&gt;</span> <span class="pre">5.4.95-1)</span></code>,
<code class="docutils literal notranslate"><span class="pre">linux-lts-headers</span></code> will depend on the unavailable glibc <code class="docutils literal notranslate"><span class="pre">2.33</span></code></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># /var/lib/dkms/zfs/2.0.2/build/config.log</span>

configure:18576: checking whether modules can be built
configure:18746:
            <span class="nv">KBUILD_MODPOST_NOFINAL</span><span class="o">=</span> <span class="nv">KBUILD_MODPOST_WARN</span><span class="o">=</span>
            make modules -k -j4 -C /usr/lib/modules/5.4.95-1-lts/build
            <span class="nv">M</span><span class="o">=</span>/var/lib/dkms/zfs/2.0.2/build/build/conftest &gt;build/conftest/build.log <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
configure:18749: <span class="nv">$?</span> <span class="o">=</span> <span class="m">2</span>
configure:18752: <span class="nb">test</span> -f build/conftest/conftest.ko
configure:18755: <span class="nv">$?</span> <span class="o">=</span> <span class="m">1</span>
configure:18764: result: no
configure:18767: error:
        *** Unable to build an empty module.
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span># /var/lib/dkms/zfs/2.0.2/build/build/conftest/build.log

make: Entering directory &#39;/usr/lib/modules/5.4.95-1-lts/build&#39;
  CC [M]  /var/lib/dkms/zfs/2.0.2/build/build/conftest/conftest.o
scripts/basic/fixdep: /usr/lib/libc.so.6: version `GLIBC_2.33&#39; not found (required by scripts/basic/fixdep)
make[1]: *** [scripts/Makefile.build:262: /var/lib/dkms/zfs/2.0.2/build/build/conftest/conftest.o] Error 1
make[1]: *** Deleting file &#39;/var/lib/dkms/zfs/2.0.2/build/build/conftest/conftest.o&#39;
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -Qo /usr/lib/modules/5.4.95-1-lts/build/scripts/basic/fixdep
/usr/lib/modules/5.4.95-1-lts/build/scripts/basic/fixdep is owned by linux-lts-headers <span class="m">5</span>.4.95-1
</pre></div>
</div>
<p>To solve the problem, rollback kernel update
and postpone kernel updates
until glibc <code class="docutils literal notranslate"><span class="pre">2.33</span></code> becomes available.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /var/cache/pacman/pkg/
pacman -U linux-lts-5.4.94-1-x86_64.pkg.tar.zst linux-lts-headers-5.4.94-1-x86_64.pkg.tar.zst
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="check-live-image-compatibility">
<h2><a class="toc-backref" href="#id12">Check Live Image Compatibility</a><a class="headerlink" href="#check-live-image-compatibility" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Choose a mirror:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>https://archlinux.org/mirrorlist/all/
https://gitea.artixlinux.org/packagesA/artix-mirrorlist/src/branch/master/trunk/mirrorlist
</pre></div>
</div>
</li>
<li><p>Check the build date of the
latest Arch Linux live image:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>https://mirrors.dotsrc.org/archlinux/iso/latest/
https://mirrors.dotsrc.org/artix-linux/iso/
<span class="c1"># archlinux-2021.01.01-x86_64.iso</span>
</pre></div>
</div>
</li>
<li><p>Check the kernel version of the live image:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>https://archive.archlinux.org/repos/2021/01/01/core/os/x86_64
https://archive.artixlinux.org/repos/2021/01/01/system/os/x86_64
<span class="c1"># linux-5.10.3.arch1-1-x86_64.pkg.tar.zst</span>
</pre></div>
</div>
</li>
<li><p>Check latest archzfs package version:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>https://archzfs.com/archzfs/x86_64/
<span class="c1"># zfs-dkms-2.0.1-1-x86_64.pkg.tar.zst</span>
<span class="c1"># zfs-linux-2.0.1_5.10.10.arch1.1-1-x86_64.pkg.tar.zst</span>
</pre></div>
</div>
</li>
<li><p>Visit OpenZFS release page <a class="reference external" href="https://github.com/openzfs/zfs/releases/tag/zfs-2.0.1">https://github.com/openzfs/zfs/releases/tag/zfs-2.0.1</a>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Linux: compatible with 3.10 - 5.10 kernels</span>
</pre></div>
</div>
<ul>
<li><p>If compatible, download the latest live image:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>https://mirrors.dotsrc.org/archlinux/iso/latest/archlinux-2021.01.01-x86_64.iso
https://mirrors.dotsrc.org/artix-linux/iso/artix-base-openrc-20210101-x86_64.iso
</pre></div>
</div>
</li>
<li><p>If not compatible, use an older live image and verify that it contains
a supported kernel using the above method:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>https://mirrors.dotsrc.org/archlinux/iso/
https://iso.artixlinux.org/archived-isos.php
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="root-on-zfs">
<h2><a class="toc-backref" href="#id13">Root on ZFS</a><a class="headerlink" href="#root-on-zfs" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="Arch Linux Root on ZFS.html">Arch Linux Root on ZFS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Artix Linux Root on ZFS.html">Artix Linux Root on ZFS</a></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Arch Linux Root on ZFS.html" class="btn btn-neutral float-right" title="Arch Linux Root on ZFS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../index.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, OpenZFS.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>